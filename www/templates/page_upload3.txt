{assign var="page_title" value="Upload some dots!"}
{include file="inc_head.txt"}

{if $error|@count}
{$error|@dumper}
{/if}

{if $error.uploads_disabled}
<p class="error">Uploads are currently disabled.</p>

{elseif $step=='import'}
	<div class="section_bunch_o_text">
	{if $import.ok}
		{include file="inc_upload_success.txt" upload=$import}
	{else}
	<p class="error">Your upload failed with the following errors:{if $rsp.error} {$rsp.error|escape}{/if}</p>

	{if $rsp.errors|@count}
	<ul>
	{foreach from=$rsp.errors item="row"}
		<li><q>{$row.error|escape}</q> at record #{$row.record|escape}</li>
	{/foreach}
	</ul>

	{/if}

	{/if}
	</div>

{elseif $step=='confirm'}
<div class="section_bunch_o_text">
{if $is_flickr}
<h3>Are you sure you want to import the file titled <q class="important">{$parsed_url.path|@basename|escape}</q> from <q class="important">Flickr</q> into Dotspotting?</h3>
{elseif $is_google}
<h3>Are you sure you want to import the file titled <q class="important">{$parsed_url.path|@basename|escape}</q> from <q class="important">Google</q> into Dotspotting?</h3>
{else}
<h3>Are you sure you want to import the file titled <q class="important">{$parsed_url.path|@basename|escape}</q> from the website <q class="important">{$parsed_url.host|escape}</q> into Dotspotting?</h3>
{/if}
<p class="tx1"><span style="font-style:italic;">The complete URL of the file you are about to import is: <code>{$url|escape}</code></span></p>

<form id="upload_file" method="POST" action="{$cfg.abs_root_url}{if $upload_endpoint}{$upload_endpoint|escape:'url'}/{else}upload/{/if}">
	{$crumb_key|crumb_input}
	<input type="hidden" name="confirm" value="1" />
	<input type="hidden" name="url" value="{$url|escape}" />


	{* {include file="inc_upload_file_attributes.txt"} *}

	<span class="upload_submit"><input type="submit" value="YES, PLEASE TO IMPORT" /></span>
</form>
</div>
{elseif $step=='process'}

{if $sheets|@count}

{/if}

{* 
	was getting array_keys, first parameter must not be NULL error
	temp fix, need to look through upload3.php or somewhere (seanc | 031112011)
*}
{if $pre_process.data.0}
{include file="inc_upload_preprocess.txt data=$pre_process.data columns=$pre_process.data.0|@array_keys errors=$pre_process.errors}
{else}
{include file="inc_upload_preprocess.txt data=$pre_process.data columns=$pre_process.data|@array_keys errors=$pre_process.errors}
{/if}

{else}

{include file="inc_upload_file.txt"}

{/if}

{include file="inc_foot.txt"}
