<script type="text/javascript">
{literal}
    $.fn.dataTableExt.oApi.fnSetFilteringHooks = function (oSettings){

	var _that = this;
	
	this.each( function (i){
		$.fn.dataTableExt.iApiIndex = i;

		var iDelay = 250;
		var $this = this;
		var oTimerId = null;
		var sPreviousSearch = null;
		var anControl = $('input', _that.fnSettings().aanFeatures.f);
		
		anControl.unbind('keyup').bind( 'keyup', function(){
			var $$this = $this;

			if (sPreviousSearch === null || sPreviousSearch != anControl.val()) {
				window.clearTimeout(oTimerId);
				sPreviousSearch = anControl.val();

				oTimerId = window.setTimeout(function() {
					$.fn.dataTableExt.iApiIndex = i;
					_that.fnFilter( anControl.val() );

					// ok! now we get into dotspotting stuff!

					draw_map();
				}, iDelay);
			}
		});
		
		return this;
	});

	return this;
    }
{/literal}

{if $is_sheet}
	{literal}
	$(document).ready(function(){ 

	     $('#user_dots').dataTable({
		"bPaginate": false,
		"bFilter": true,
		"bInfo" : false,
		"bProcessing": true,
	     }).fnSetFilteringHooks();
		
		/*	removed for now, doesn't make much sense IMHO
		
		// add hover event to table rows, that will highlight dot
		$('#user_dots').find('tr').hover(
		    function()
		    {
		        dot_tr_hover(this,"over");
		    },
		    function()
		    {
		        dot_tr_hover(this,"off");
			}
		);
		*/
	});
		
	{/literal}
{else}
	{literal}
	$(document).ready(function(){ 
	
	     $('#user_dots').dataTable({
		"bPaginate": false,
		"bFilter": false,	// figure out how best to enable this
		"bSort": false,
		"bInfo" : false,
		"bProcessing": true,
	     });

	});
	{/literal}
{/if}
</script>
