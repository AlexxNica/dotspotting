<script type="text/javascript">
{literal}

function draw_map_polymaps(lat, lon){

	var more = { 'static': 1 };
	var map = utils_polymap('map', more);

	map.center({lat: lat, lon: lon});
	map.zoom(14);

	var po = org.polymaps;
	var points = po.geoJson();

console.log(lat + ',' + lon);

	points.features([{
		'geometry': {
			'type': 'Point',
			'coordinates': [ lon, lat ],
		}
	}]);

	points.on("load", utils_polymaps_assign_dot_properties);

	map.add(points);
}

function draw_map_modestmaps(lat, lon){

	var more = { 'static' : 1 };	 
	var map = utils_modestmap('map', more);

	var loc = new com.modestmaps.Location(lat, lon);
    	map.setCenterZoom(loc, 14);

	// see how this is different than what we pass
	// to polymaps? that's a known-known and today
	// it is a problem that is dressed in hairy yak
	// clothes...it should be sorted out though.
	// (20101028/straup)

	var more = { 'globalAlpha' : .6 };

	var markers = new mm.Markers(map);
	markers.drawPoints([[lat, lon]], more);
}

function draw_map (lat, lon){

	if (canhas_polymaps){
		draw_map_polymaps(lat, lon);
		return;
	}

	draw_map_modestmaps(lat, lon);
}

{/literal}

var lat = {$dot.latitude|escape};
var lon = {$dot.longitude|escape};

draw_map(lat, lon);

</script>
